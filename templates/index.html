<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>å¸­æ›¿ãˆAI</title>
  <!-- Sortable.jsã®è¿½åŠ  -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .container {
      display: none; /* åˆæœŸã¯éè¡¨ç¤º */
      gap: 20px;
      margin: 20px 0;
    }
    .left-pane {
      border: 2px solid #333;
      padding: 10px;
      min-width: 300px;
      flex-grow: 1;
      position: relative; /* åº§å¸­ãƒãƒƒãƒ—ã¨é‡ã­ã‚‹ãŸã‚ã« relative */
    }

    /* åº§å¸­ãƒãƒƒãƒ— */
    .seat-map {
      border: 1px solid #666;
      position: relative;
      height: 300px;
      background: #f0f0f0;
      margin-bottom: 10px;
      user-select: none;
      overflow: visible; /* ãƒœã‚¿ãƒ³ã‚’éš ã•ãªã„ */
      z-index: 1;
    }


    /* ãƒãƒƒãƒ—ã®ãƒªã‚µã‚¤ã‚ºãƒœã‚¿ãƒ³ */
    .resize-handle {
      width: 20px;
      height: 20px;
      background: white;
      border: 2px solid #444; /* ç™½æ ã®ä¸¸ */
      border-radius: 50%; /* ä¸¸ã«ã™ã‚‹ */
      position: absolute;
      bottom: -10px; /* ä½ç½®èª¿æ•´ */
      right: -10px;  
      cursor: nwse-resize;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³ã®è¿½åŠ  */
    .resize-handle::after {
      content: "â¤¡"; /* æ–œã‚å‘ãã®åŒé ­çŸ¢å° */
      font-size: 20px;
      color: #444;
    }



    .seat {
      position: absolute;
      width: 60px;
      height: 40px;
      background: #fff;
      border: 2px solid #444;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s;
      cursor: move; /* å¸­è‡ªä½“ã‚’ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ã™ã‚‹ */
    }

    .right-pane {
      border: 2px solid #333;
      padding: 10px;
      min-width: 300px;
    }
    .preferences-area {
      border: 1px solid #666;
      padding: 5px;
      margin-top: 10px;
      max-height: 400px; /* ä¸Šé™ã‚’è¨­ã‘ã‚‹ */
      overflow-y: auto; /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
    }

    .sortable-list {
      list-style: none;
      padding: 0;
      border: 1px solid #ccc;
      min-height: 40px;
      margin: 5px 0;
    }
    .sortable-item {
      border: 1px solid #aaa;
      padding: 5px 10px;
      margin: 2px;
      background: #eef;
      cursor: move;
    }
    .sortable-ghost {
      opacity: 0.6;
      background: #ff0;
    }

    /* ãƒœã‚¿ãƒ³é¡ã‚’åˆæœŸéè¡¨ç¤ºã«ã™ã‚‹ */
    #preferenceBtn,
    #callApiBtn {
      display: none; /* åˆæœŸã¯éè¡¨ç¤º */
    }
  </style>
</head>
<body>
  <h1>å¸­æ›¿ãˆAI</h1>

  <!-- äººæ•°ã¨ãƒ¢ãƒ‡ãƒ«é¸æŠ -->
  <div>
    <!-- äººæ•°Nã‚’å…¥åŠ› -->
    <label>äººæ•°: 
      <input id="inputN" type="number" value="4" min="1">
    </label>
    <span style="margin-right: 20px;"></span>
    <label>AIãƒ¢ãƒ‡ãƒ«(1=ã‚¬ã‚¦ã‚¹, 2=é€†äºŒä¹—): 
      <input id="inputM" type="number" value="1" min="1" max="2">
    </label>
  </div>

  <!-- (A) åº§æ¨™å…¥åŠ›æ¬„ç”Ÿæˆãƒœã‚¿ãƒ³ -->
  <p>
    <button id="coordBtn" onclick="setupCoordinates()">åº§å¸­ã®åº§æ¨™ã‚’æ±ºã‚ã‚‹</button>
  </p>

  <!-- (B) åº§æ¨™å…¥åŠ›æ¬„ -->
  <div id="coordinateInputs"></div>

  <!-- (C) å¸Œæœ›é…ç½®å…¥åŠ›æ¬„ç”Ÿæˆãƒœã‚¿ãƒ³ ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰-->
  <p>
    <button id="preferenceBtn" onclick="setupSeatPreferences()">å¸Œæœ›é…ç½®ã‚’æ±ºã‚ã‚‹</button>
  </p>

  <!-- (D) å·¦(åº§å¸­) & å³(å¸Œæœ›é…ç½®) -->
  <div class="container">
    <div class="left-pane">
      <div id="seatMap" class="seat-map">
        <div id="resizeHandle" class="resize-handle"></div> <!-- è¿½åŠ  -->
      </div>
    </div>
    <div class="right-pane">
      <div id="preferencesArea" class="preferences-area"></div>
    </div>
  </div>


  <!-- (E) è¨ˆç®—å®Ÿè¡Œãƒœã‚¿ãƒ³ ï¼ˆéè¡¨ç¤ºï¼‰-->
  <p>
    <button id="callApiBtn" onclick="callApi()">è¨ˆç®—å®Ÿè¡Œ</button>
  </p>

  <pre id="result"></pre>




<!-- javascript -->
<script>
  let seatCoordinate = [];       // [[x,y], [x,y], ...]
  let seatPreferenceList = [];   // [[seatIDé †åº], ..., [seatIDé †åº]]

  // ã‚°ãƒªãƒƒãƒ‰ã‚„åº§æ¨™è¨ˆç®—ç”¨ã®å¤‰æ•°
  let scale = 1;
  let maxX = 0, maxY = 0;
  const MARGIN = 40;
  let svgGrid = null;           // ä¸€åº¦æç”»ã—ãŸSVGã‚°ãƒªãƒƒãƒ‰ã‚’ä¿æŒ
  const seatMapEl = document.getElementById("seatMap");
  const prefsAreaEl = document.getElementById("preferencesArea");

  // ============ (1) åº§æ¨™å…¥åŠ›æ¬„ã‚’ç”Ÿæˆ ============
  function setupCoordinates() {
    const N = +document.getElementById("inputN").value;
    const coordDiv = document.getElementById("coordinateInputs");
    coordDiv.innerHTML = "";

    // (a) å¸Œæœ›é…ç½®ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
    document.getElementById("preferenceBtn").style.display = "inline-block";
    // document.getElementById("callApiBtn").style.display = "inline-block";ã€€ã“ã“ã§ã¯éè¡¨ç¤º
    // (b) ãƒãƒƒãƒ— & å³ãƒšã‚¤ãƒ³ã‚’è¡¨ç¤º
    document.querySelector(".container").style.display = "flex";

    // (c) åº§æ¨™ã®åˆæœŸåŒ– & å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ
    seatCoordinate = [];
    const seatsPerRow = 6; // 1è¡Œã«é…ç½®ã™ã‚‹åº§å¸­æ•°
    for (let i = 0; i < N; i++) {
      let x = i % seatsPerRow; // 6å€‹ã”ã¨ã«æŠ˜ã‚Šè¿”ã—
      let y = Math.floor(i / seatsPerRow); // è¡Œæ•°ï¼ˆ0è¡Œç›®, 1è¡Œç›®, 2è¡Œç›®â€¦ï¼‰
      seatCoordinate.push([x, y]);
    }


    // æ—¢å­˜ã®SVGã‚°ãƒªãƒƒãƒ‰ã‚’æ¶ˆå»
    seatMapEl.innerHTML = "";
    svgGrid = null; // ã‚°ãƒªãƒƒãƒ‰å†ä½œæˆãƒ•ãƒ©ã‚°

    for (let i = 0; i < N; i++) {
      let label = document.createElement("label");
      label.textContent = `åº§å¸­${i} ã®åº§æ¨™: `;

      let xInput = document.createElement("input");
      xInput.type = "number";
      xInput.placeholder = "xåº§æ¨™";
      xInput.id = `coordX_${i}`;
      xInput.value = seatCoordinate[i][0];
      xInput.min = "0"; // è² ã®å€¤ã‚’ç¦æ­¢

      let yInput = document.createElement("input");
      yInput.type = "number";
      yInput.placeholder = "yåº§æ¨™";
      yInput.id = `coordY_${i}`;
      yInput.value = seatCoordinate[i][1];
      yInput.min = "0"; // è² ã®å€¤ã‚’ç¦æ­¢

      coordDiv.appendChild(label);
      coordDiv.appendChild(xInput);
      coordDiv.appendChild(yInput);
      coordDiv.appendChild(document.createElement("br"));

      xInput.addEventListener("input", () => {
        let newValue = parseFloat(xInput.value) || 0;
        if (newValue < 0) newValue = 0; // è² ã®å€¤ãªã‚‰ 0 ã«ä¿®æ­£
        xInput.value = newValue;
        seatCoordinate[i][0] = newValue;
        updateAllSeats();
      });

      yInput.addEventListener("input", () => {
        let newValue = parseFloat(yInput.value) || 0;
        if (newValue < 0) newValue = 0; // è² ã®å€¤ãªã‚‰ 0 ã«ä¿®æ­£
        yInput.value = newValue;
        seatCoordinate[i][1] = newValue;
        updateAllSeats();
      });
    }

    // åˆå›å…¨å†æç”»
    updateAllSeats();
    
    // ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯è¿½åŠ 
    if (!document.getElementById("resizeHandle")) {
      const resizeHandle = document.createElement("div");
      resizeHandle.id = "resizeHandle";
      resizeHandle.className = "resize-handle";
      seatMapEl.appendChild(resizeHandle);

      // ã“ã“ã§ `resizeHandle` ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²
      registerResizeEvent();

    }

  }

  // ============ (2) å…¨åº§å¸­ã‚’ã¾ã¨ã‚ã¦å†æç”» (å…¥åŠ›æ¬„å¤‰æ›´æ™‚ã«å‘¼ã¶) ============
  function updateAllSeats() {
    const N = +document.getElementById("inputN").value;
    
    // (1) ç¾åœ¨ã®åº§å¸­è¦ç´ ã‚’å‰Šé™¤ï¼ˆresizeHandleã¯æ®‹ã™ï¼‰
    const seats = seatMapEl.querySelectorAll(".seat");
    seats.forEach(seat => seat.remove());

    // (2) ä»¥å‰ã®ã‚°ãƒªãƒƒãƒ‰ã‚’å‰Šé™¤
    if (svgGrid) {
      svgGrid.remove();
    }

    svgGrid = null; // ã‚°ãƒªãƒƒãƒ‰ã‚’æ¯å›ä½œã‚Šç›´ã™

    // **è¡Œæ•°ã‚’è¨ˆç®—**
    const seatsPerRow = 6;
    const numRows = Math.ceil(N / seatsPerRow);

    // **(1) `seat-map` ã®é«˜ã•ã‚’å‹•çš„ã«å¤‰æ›´**
    const baseHeight = 300;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é«˜ã•
    const extraHeightPerRow = 60;  // è¿½åŠ ã™ã‚‹é«˜ã•
    if (numRows > 5) {
        seatMapEl.style.height = `${baseHeight + (numRows - 5) * extraHeightPerRow}px`;
    } else {
        seatMapEl.style.height = `${baseHeight}px`;
    }

    // **(2) ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—**
    [maxX, maxY] = [0, 0];
    seatCoordinate.forEach(([x, y]) => {
        if (x > maxX) maxX = x;
        if (y > maxY) maxY = y;
    });
    if (maxX < 1) maxX = 1;
    if (maxY < 1) maxY = 1;

    const mapW = seatMapEl.clientWidth - (MARGIN * 2);
    const mapH = seatMapEl.clientHeight - (MARGIN * 2);
    scale = Math.min(mapW / maxX, mapH / maxY);

    // **(3) SEAT_SIZE ã‚’çµ±ä¸€çš„ã«æ±ºå®š**
    SEAT_SIZE = scale * 0.9;

    // **(4) SVGã‚°ãƒªãƒƒãƒ‰ã‚’ä½œã‚Šç›´ã™**
    svgGrid = createGrid(maxX, maxY, scale);
    seatMapEl.appendChild(svgGrid);

    // **(5) åº§å¸­ã‚’ã™ã¹ã¦é…ç½®**
    for (let i = 0; i < N; i++) {
        createSeatElement(i);
    }

    // **(6) ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®è¨­å®š(å†è¨­å®š)**
    seatMapEl.addEventListener("dragover", handleDragOver);
    seatMapEl.addEventListener("drop", handleDrop); 
  }



  // ============ (3) SVGã‚°ãƒªãƒƒãƒ‰ã‚’ä½œã‚‹ ============
  function createGrid(mx, my, scaleVal) {
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.style.position = "absolute";
    svg.style.width = "100%";
    svg.style.height = "100%";
    svg.style.top = "0";
    svg.style.left = "0";

    for (let x = 0; x <= mx; x++) {
      let lineV = document.createElementNS("http://www.w3.org/2000/svg", "line");
      let px = MARGIN + x * scaleVal;
      lineV.setAttribute("x1", px);
      lineV.setAttribute("y1", MARGIN);
      lineV.setAttribute("x2", px);
      lineV.setAttribute("y2", MARGIN + my * scaleVal);
      lineV.setAttribute("stroke", "#ddd");
      svg.appendChild(lineV);
    }
    for (let y = 0; y <= my; y++) {
      let lineH = document.createElementNS("http://www.w3.org/2000/svg", "line");
      let py = MARGIN + y * scaleVal;
      lineH.setAttribute("x1", MARGIN);
      lineH.setAttribute("y1", py);
      lineH.setAttribute("x2", MARGIN + mx * scaleVal);
      lineH.setAttribute("y2", py);
      lineH.setAttribute("stroke", "#ddd");
      svg.appendChild(lineH);
    }
    return svg;
  }


  // ============ (4) åº§å¸­ã‚’1ã¤ä½œæˆã—ã¦è¿½åŠ  ============
  function createSeatElement(seatIndex) {
    const [xx, yy] = seatCoordinate[seatIndex];
    const seatDiv = document.createElement("div");
    seatDiv.className = "seat";
    seatDiv.textContent = `å¸­${seatIndex}`;
    seatDiv.dataset.seatIndex = seatIndex;
    seatDiv.draggable = true;

    // **ä¸­å¤®æƒãˆã®èª¿æ•´**
    const px = MARGIN + xx * scale;
    const py = MARGIN + yy * scale;

    seatDiv.style.width = SEAT_SIZE + "px";
    seatDiv.style.height = SEAT_SIZE + "px";

    // **æ•´æ•°ã‚°ãƒªãƒƒãƒ‰ã«æ­£ã—ãåˆã†ã‚ˆã†ã«ä¿®æ­£**
    seatDiv.style.left = Math.round(px - SEAT_SIZE / 2) + "px";
    seatDiv.style.top = Math.round(py - SEAT_SIZE / 2) + "px";

    // **ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ `scale` ã«å¿œã˜ã¦èª¿æ•´**
    let fontSize = Math.max(8, Math.min(16, scale * 0.5)); // 8pxï½16pxã®ç¯„å›²ã§ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
    seatDiv.style.fontSize = `${fontSize}px`;

    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
    seatDiv.addEventListener("dragstart", (ev) => {
        ev.dataTransfer.setData("seatIndex", seatIndex);
    });

    seatMapEl.appendChild(seatDiv);
  }


  // ============ (5) ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®å‡¦ç† ============
  function handleDragOver(ev) {
    ev.preventDefault(); 
  }

  function handleDrop(ev) {
    ev.preventDefault();
    const seatIndex = parseInt(ev.dataTransfer.getData("seatIndex"), 10);
    if (isNaN(seatIndex)) return;

    const rect = seatMapEl.getBoundingClientRect();
    let offsetX = ev.clientX - rect.left - MARGIN;
    let offsetY = ev.clientY - rect.top  - MARGIN;

    // ãƒ”ã‚¯ã‚»ãƒ« -> å®Ÿæ•°åº§æ¨™
    let gridX = offsetX / scale;
    let gridY = offsetY / scale;

    // æ•´æ•°ã‚°ãƒªãƒƒãƒ‰ã«ä¸¸ã‚ã‚‹
    const newX = Math.round(gridX);
    const newY = Math.round(gridY);
    if (newX < 0 || newY < 0) return;

    // åº§æ¨™ã‚’æ›´æ–°
    seatCoordinate[seatIndex][0] = newX;
    seatCoordinate[seatIndex][1] = newY;

    // å¯¾å¿œå…¥åŠ›æ¬„ã‚’æ›´æ–°
    const xInput = document.getElementById(`coordX_${seatIndex}`);
    const yInput = document.getElementById(`coordY_${seatIndex}`);
    if (xInput && yInput) {
      xInput.value = newX;
      yInput.value = newY;
    }

    // éƒ¨åˆ†æ›´æ–°: seatIndex ã®åº§å¸­ã ã‘ç§»å‹•ã—ç›´ã™
    moveSeat(seatIndex);
  }

  // ============ (6) éƒ¨åˆ†æ›´æ–°: 1ã¤ã®åº§å¸­ã ã‘åº§æ¨™ã‚’æ›´æ–° ============
  function moveSeat(seatIndex) {
    const seatDiv = seatMapEl.querySelector(`.seat[data-seat-index='${seatIndex}']`);
    if (!seatDiv) return;

    const [xx, yy] = seatCoordinate[seatIndex];
    const px = MARGIN + xx * scale;
    const py = MARGIN + yy * scale;

    // **ä¸­å¤®æƒãˆã®ãŸã‚ã®ä¿®æ­£**
    seatDiv.style.left = Math.round(px - SEAT_SIZE / 2) + "px";
    seatDiv.style.top = Math.round(py - SEAT_SIZE / 2) + "px";

    // **ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ `scale` ã«å¿œã˜ã¦å¤‰æ›´**
    let fontSize = Math.max(8, Math.min(16, scale * 0.5));
    seatDiv.style.fontSize = `${fontSize}px`;
  }



  // ============ (7) å¸Œæœ›é…ç½®ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—UIã‚’ç”Ÿæˆ ============
  function setupSeatPreferences() {
    const N = +document.getElementById("inputN").value;
    prefsAreaEl.innerHTML = "";  // UIãƒªã‚»ãƒƒãƒˆ

    seatPreferenceList = [];
    for (let i = 0; i < N; i++) {
        seatPreferenceList.push([...Array(N).keys()]); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä¸¦ã³
    }

    for (let i = 0; i < N; i++) {
        const personDiv = document.createElement("div");
        personDiv.style.margin = "10px 0";
        personDiv.style.display = "flex"; // å¸­ãƒªã‚¹ãƒˆã¨äººãƒªã‚¹ãƒˆã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹
        personDiv.style.alignItems = "center";

        // (1) ã‚¿ã‚¤ãƒˆãƒ«ã€Œäºº i ã®å¸Œæœ›é…ç½®ã€
        let label = document.createElement("h4");
        label.textContent = `äºº${i} ã®å¸Œæœ›é…ç½®`;
        label.style.marginRight = "20px";
        personDiv.appendChild(label);

        // (2) å¸­ãƒªã‚¹ãƒˆ (å·¦å´ã€å›ºå®š)
        let seatList = document.createElement("ul");
        seatList.className = "sortable-list";
        seatList.style.pointerEvents = "none"; // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‰ãƒ©ãƒƒã‚°ã§ããªã„ã‚ˆã†ã«ã™ã‚‹

        for (let seatID = 0; seatID < N; seatID++) {
            let seatItem = document.createElement("li");
            seatItem.className = "sortable-item";
            seatItem.textContent = `å¸­${seatID}`;
            seatItem.style.background = "#ddd";  // å›ºå®šãƒªã‚¹ãƒˆã®è‰²
            seatList.appendChild(seatItem);
        }

        // (3) ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªäººãƒªã‚¹ãƒˆ (å³å´)
        let personList = document.createElement("ul");
        personList.id = `prefList_${i}`;
        personList.className = "sortable-list";
        personList.style.marginLeft = "10px";

        seatPreferenceList[i].forEach((personID) => {
            let item = document.createElement("li");
            item.className = "sortable-item";
            item.textContent = `äºº${personID}`;
            item.dataset.personId = personID;
            personList.appendChild(item);
        });

        personDiv.appendChild(seatList);
        personDiv.appendChild(personList);
        prefsAreaEl.appendChild(personDiv);

        // (4) Sortable.js ã®é©ç”¨ï¼ˆãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ã™ã‚‹ï¼‰
        new Sortable(personList, {
            animation: 150,
            ghostClass: "sortable-ghost",
            onEnd: () => {
                const newOrder = [];
                personList.querySelectorAll(".sortable-item").forEach((li) => {
                    newOrder.push(parseInt(li.dataset.personId, 10));
                });
                seatPreferenceList[i] = newOrder;
            },
        });
    }
    // ã“ã“ã§è¨ˆç®—å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
    document.getElementById("callApiBtn").style.display = "inline-block"; // è¨ˆç®—å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º

  }


  // ============ (8) APIã¸é€ä¿¡ ============
  // APIå‘¼ã³å‡ºã—éƒ¨åˆ†ã‚’ä¿®æ­£
  async function callApi() {
    const N = +document.getElementById("inputN").value;
    const M = +document.getElementById("inputM").value;

    const body = {
        N,
        seatPreferenceList,
        seatCoordinate,
        M,
    };

    console.log("ğŸ“¤ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:", JSON.stringify(body, null, 2)); // ãƒ‡ãƒãƒƒã‚°ç”¨

    try {
        const res = await fetch("/arrange", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body),
        });

        if (!res.ok) {
            throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${res.status}`);
        }

        const json = await res.json();
        console.log("ğŸ“© å—ä¿¡ãƒ‡ãƒ¼ã‚¿:", json);

        //document.getElementById("result").textContent = JSON.stringify(json, null, 2);
        
        // best_configurations ã‚’æç”»
        displayBestConfigurations(json.best_configurations);
    } catch (e) {
        console.error("APIã‚¨ãƒ©ãƒ¼:", e);
        document.getElementById("result").textContent = "ã‚¨ãƒ©ãƒ¼: " + e.message;
    }
  }


  // best_configurations ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ã‚’ä½œæˆ
  function displayBestConfigurations(bestConfigurations) {
    const bestConfigArea = document.getElementById("bestConfigArea");
    if (!bestConfigArea) {
        const newDiv = document.createElement("div");
        newDiv.id = "bestConfigArea";
        newDiv.innerHTML = "<h2>æœ€é©ãªå¸­é…ç½®</h2>";
        document.body.appendChild(newDiv);
    }

    const area = document.getElementById("bestConfigArea");
    area.innerHTML = "<h2>AIã®ææ¡ˆã™ã‚‹å¸­é…ç½®</h2>";

    bestConfigurations.forEach((config, index) => {
        setTimeout(() => {
            const mapDiv = document.createElement("div");
            mapDiv.className = "seat-map";
            mapDiv.style.position = "relative";
            mapDiv.style.border = "1px solid black";
            mapDiv.style.marginBottom = "20px";
            mapDiv.style.padding = "10px";

            // ãƒ©ãƒ™ãƒ«
            const label = document.createElement("h3");
            label.textContent = `é…ç½®ãƒ‘ã‚¿ãƒ¼ãƒ³ ${index + 1}`;
            area.appendChild(label);

            requestAnimationFrame(() => {
                // åº§å¸­ã‚’é…ç½®
                seatCoordinate.forEach(([x, y], seatIndex) => {
                    const seatDiv = document.createElement("div");
                    seatDiv.className = "seat";
                    seatDiv.style.width = "60px";
                    seatDiv.style.height = "40px";
                    seatDiv.style.position = "absolute";
                    seatDiv.style.left = `${x * 70}px`;
                    seatDiv.style.top = `${y * 50}px`;
                    seatDiv.style.background = "#ccc";
                    seatDiv.style.border = "2px solid #444";
                    seatDiv.style.display = "flex";
                    seatDiv.style.alignItems = "center";
                    seatDiv.style.justifyContent = "center";
                    seatDiv.style.fontSize = "14px";

                    // AIãŒæ±ºã‚ãŸäººã®å‰²ã‚Šå½“ã¦ã‚’è¡¨ç¤º
                    seatDiv.textContent = `äºº${config[seatIndex]}`;

                    mapDiv.appendChild(seatDiv);
                });

                area.appendChild(mapDiv);
            });
        }, index * 100); // 0.1ç§’ã”ã¨ã«æ¬¡ã®é…ç½®ã‚’æç”»
    });
  }



  // ========== (9) ãƒãƒƒãƒ—æ ã®ã‚µã‚¤ã‚ºå¤‰æ›´æ©Ÿèƒ½ ==========
  const resizeHandle = document.getElementById("resizeHandle");
  let isResizing = false;

  // ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³æ™‚ã«ãƒªã‚µã‚¤ã‚ºé–‹å§‹
  resizeHandle.addEventListener("mousedown", (e) => {
    isResizing = true;
    document.addEventListener("mousemove", resize);
    document.addEventListener("mouseup", () => {
      isResizing = false;
      updateAllSeats();  // ãƒªã‚µã‚¤ã‚ºå¾Œã«åº§å¸­ã‚’å†æç”»
      document.removeEventListener("mousemove", resize);
    });
  });

  function resize(e) {
    if (!isResizing) return;
    
    const newWidth = e.clientX - seatMapEl.offsetLeft;
    const newHeight = e.clientY - seatMapEl.offsetTop;
    
    // ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆæœ€å°300px, æœ€å¤§1200pxï¼‰
    seatMapEl.style.width = `${Math.max(300, Math.min(newWidth, 1200))}px`;
    seatMapEl.style.height = `${Math.max(300, Math.min(newHeight, 800))}px`;
  }

  function registerResizeEvent() {
    const resizeHandle = document.getElementById("resizeHandle");
    if (!resizeHandle) return;

    let isResizing = false;
    let startX, startY;
    let startWidth, startHeight;

    resizeHandle.addEventListener("mousedown", (e) => {
        isResizing = true;
        startX = e.clientX;
        startY = e.clientY;
        startWidth = seatMapEl.offsetWidth;
        startHeight = seatMapEl.offsetHeight;

        document.addEventListener("mousemove", resize);
        document.addEventListener("mouseup", stopResize);
    });

    function resize(e) {
        if (!isResizing) return;

        // ãƒã‚¦ã‚¹ã®ç§»å‹•è·é›¢ã‚’è¨ˆç®—
        const deltaX = e.clientX - startX;
        const deltaY = e.clientY - startY;

        // `seatMapEl` ã®ã‚µã‚¤ã‚ºã®ã¿å¤‰æ›´ (åº§å¸­ã‚„ã‚°ãƒªãƒƒãƒ‰ã®ã‚µã‚¤ã‚ºã¯å¤‰ãˆãªã„)
        seatMapEl.style.width = `${Math.max(300, Math.min(startWidth + deltaX, 1200))}px`;
        seatMapEl.style.height = `${Math.max(300, Math.min(startHeight + deltaY, 800))}px`;
    }

    function stopResize() {
        isResizing = false;
        document.removeEventListener("mousemove", resize);
        document.removeEventListener("mouseup", stopResize);
    }
  }


</script>
</body>
</html>
